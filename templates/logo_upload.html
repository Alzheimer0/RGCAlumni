<!-- ./templates/logo_upload.html -->
{% extends "layout.html" %}

{% block title %}Logo Management - Admin{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0"><i class="fas fa-image"></i> Logo Management</h2>
                </div>
                <div class="card-body">
                    <!-- Upload Form -->
                    <div class="row">
                        <div class="col-md-6">
                            <h4><i class="fas fa-upload"></i> Upload New Logo</h4>
                            <form method="POST" enctype="multipart/form-data" class="mb-4">
                                <div class="mb-3">
                                    <label for="logo_type" class="form-label">Logo Type</label>
                                    <select class="form-select" id="logo_type" name="logo_type" required>
                                        <option value="primary">Primary Logo (College Logo)</option>
                                        <option value="secondary">Secondary Logo (Alumni Logo)</option>
                                        <option value="favicon">Favicon</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="logo_file" class="form-label">Logo File</label>
                                    <div class="logo-drop-zone" onclick="document.getElementById('logo_file').click()">
                                        <input type="file" class="form-control d-none" id="logo_file" name="logo_file" 
                                               accept=".png,.jpg,.jpeg,.svg,.gif" 
                                               onchange="validateLogoFile(this); previewLogoUpload(this);" required>
                                        <div id="drop-zone-content">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                            <p class="mb-2"><strong>Click to select</strong> or drag and drop your logo here</p>
                                            <p class="text-muted small">PNG, JPG, JPEG, SVG, GIF up to 5MB</p>
                                        </div>
                                        <img id="logo-preview" class="img-fluid" style="display: none; max-height: 200px; border-radius: 8px;">
                                    </div>
                                    <div class="form-text">
                                        Recommended sizes: 200x200px for primary/secondary, 32x32px for favicon.
                                        <br>SVG format recommended for best quality scaling.
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-upload"></i> Upload Logo
                                </button>
                            </form>
                        </div>
                        
                        <!-- Preview Current Logos -->
                        <div class="col-md-6">
                            <h4><i class="fas fa-eye"></i> Current Logo Preview</h4>
                            <div class="border rounded p-3 text-center" style="background: #f8f9fa;">
                                <div class="navbar-brand-container mb-3" style="justify-content: center;">
                                    <div class="navbar-brand" style="background: rgba(52, 58, 64, 0.9);">
                                        <div class="logo-wrapper">
                                            <img id="preview-primary-logo" 
                                                 src="{{ url_for('static', filename='image/RGC.jpeg') }}" 
                                                 alt="Primary Logo Preview" 
                                                 class="logo-image primary-logo">
                                        </div>
                                        <div class="logo-text">
                                            <span class="college-name-short">RGCACS</span>
                                            <span class="alumni-text">Alumni Portal</span>
                                        </div>
                                    </div>
                                    <button class="logo-switch-btn" onclick="togglePreview()" type="button">
                                        <i class="fas fa-exchange-alt"></i>
                                    </button>
                                </div>
                                <p class="mb-0 text-muted">Live preview of current logo setup</p>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Logo Management Table -->
                    <h4><i class="fas fa-list"></i> Uploaded Logos</h4>
                    {% if logos %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Preview</th>
                                    <th>Filename</th>
                                    <th>Type</th>
                                    <th>Uploaded By</th>
                                    <th>Upload Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for logo in logos %}
                                <tr class="{{ 'table-success' if logo.active else '' }}">
                                    <td>
                                        <img src="{{ url_for('static', filename='uploads/' + logo.filename) }}" 
                                             alt="Logo Preview" 
                                             class="img-thumbnail" 
                                             style="width: 50px; height: 50px; object-fit: cover;"
                                             onerror="handleImageError(this);"
                                    </td>
                                    <td>
                                        <div>{{ logo.original_filename }}</div>
                                        <small class="text-muted">{{ logo.filename }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-{{ 'primary' if logo.logo_type == 'primary' else 'secondary' if logo.logo_type == 'secondary' else 'info' }}">
                                            {{ logo.logo_type.title() }}
                                        </span>
                                    </td>
                                    <td>{{ logo.uploaded_by }}</td>
                                    <td>{{ logo.uploaded_at.strftime('%Y-%m-%d %H:%M') if logo.uploaded_at else 'N/A' }}</td>
                                    <td>
                                        {% if logo.active %}
                                            <span class="badge bg-success"><i class="fas fa-check"></i> Active</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if not logo.active %}
                                        <form method="POST" action="{{ url_for('admin_logo_activate', logo_id=logo._id) }}" 
                                              style="display: inline;" 
                                              onsubmit="return confirm('Are you sure you want to activate this logo?');">
                                            <button type="submit" class="btn btn-sm btn-success" title="Activate Logo">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> No logos uploaded yet. Upload your first logo using the form above.
                    </div>
                    {% endif %}

                    <!-- Back to Admin -->
                    <div class="mt-4">
                        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Admin Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function handleImageError(img) {
    img.src = '{{ url_for("static", filename="image/alumni.jpeg") }}';
}

function togglePreview() {
    const primaryLogo = document.getElementById('preview-primary-logo');
    const fallbackSrc = '{{ url_for("static", filename="image/alumni.jpeg") }}';
    const primarySrc = '{{ url_for("static", filename="image/RGC.jpeg") }}';
    
    if (primaryLogo.src.includes('RGC.jpeg')) {
        primaryLogo.src = fallbackSrc;
    } else {
        primaryLogo.src = primarySrc;
    }
}

// Enhanced logo upload functionality
document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.querySelector('.logo-drop-zone');
    const fileInput = document.getElementById('logo_file');
    const preview = document.getElementById('logo-preview');
    const dropZoneContent = document.getElementById('drop-zone-content');
    
    // Drag and drop handlers
    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });
    
    dropZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        dropZone.classList.remove('dragover');
    });
    
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            validateLogoFile(fileInput);
            previewLogoUpload(fileInput);
        }
    });
    
    // File input change handler
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            dropZoneContent.style.display = 'none';
            preview.style.display = 'block';
        } else {
            dropZoneContent.style.display = 'block';
            preview.style.display = 'none';
        }
    });
});

// Logo preview function
function previewLogoUpload(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        const preview = document.getElementById('logo-preview');
        const dropZoneContent = document.getElementById('drop-zone-content');
        
        reader.onload = function(e) {
            if (preview) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                dropZoneContent.style.display = 'none';
            }
        };
        
        reader.readAsDataURL(input.files[0]);
    }
}

// Validate logo file
function validateLogoFile(input) {
    const file = input.files[0];
    const maxSize = 5 * 1024 * 1024; // 5MB
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/svg+xml', 'image/gif'];
    
    if (!file) return true;
    
    if (file.size > maxSize) {
        alert('File size must be less than 5MB');
        input.value = '';
        resetPreview();
        return false;
    }
    
    if (!allowedTypes.includes(file.type)) {
        alert('Please select a valid image file (JPEG, PNG, SVG, GIF)');
        input.value = '';
        resetPreview();
        return false;
    }
    
    return true;
}

function resetPreview() {
    const preview = document.getElementById('logo-preview');
    const dropZoneContent = document.getElementById('drop-zone-content');
    
    if (preview) {
        preview.style.display = 'none';
        preview.src = '';
    }
    
    if (dropZoneContent) {
        dropZoneContent.style.display = 'block';
    }
}

// Show upload progress (if needed)
function showUploadProgress() {
    const submitBtn = document.querySelector('button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
        submitBtn.disabled = true;
    }
}

// Handle form submission
document.querySelector('form').addEventListener('submit', function() {
    showUploadProgress();
});
</script>
{% endblock %}